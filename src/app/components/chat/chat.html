<!-- contenedor completo del chat -->
<div class="chat-container">
  <header class="chat-header">
    <div class="user-info">
      <img
        src="https://www.shutterstock.com/image-vector/editable-vector-incognito-hat-glasses-260nw-2551546499.jpg"
        alt="imagen del usuario"
        class="user-avatar"
        (error)="manejoErrorImagen()"
      />
      <div class="user-details">
        <h2 class="user-name">{{ nombre }}</h2>
        <p class="user-email">{{ email }}</p>
      </div>
    </div>

    <div class="header-actions">
      <button class="logout-btn" (click)="cerrarSesion()">Salir</button>
    </div>
  </header>

  <main class="chat-messages" #messagesContainer>
    <!-- Validacion en caso de que no hayan mensajes -->
    @if (mensajes.length === 0 && !cargandoHistorial) {
      <div class="welcome-message">
        <div class="welcome-content">
          <div class="welcome-icon">ğŸ˜</div>
          <h2>Â¡Hola soy tu asistente virtual</h2>
          <p>Puedo ayudarte con tus tareas, preguntame</p>
          <p class="welcome-tip">
            <strong>Consejo </strong> Se especifico en tus preguntas para obtener mejores resultados
          </p>
        </div>
      </div>
    }

    @if (cargandoHistorial) {
      <div class="loading-history">
        <div class="loading-spinner"></div>
        <p>Cargando historial de conversaciones</p>
      </div>
    }

    <div class="messages-list">
      @for (mensaje of mensajes; track trackByMensaje($index, mensaje)) {
        <div
          class="message-wrapper"
          [class.user-message]="mensaje.tipo == 'usuario'"
          [class.assistant-message]="mensaje.tipo == 'asistente'"
        >
          <!-- validar si el mensaje del usuario -->
          @if (mensaje.tipo == 'usuario') {
            <div class="message user-msg">
              <div class="message-content">
                <p>{{ mensaje.contenido }}</p>
              </div>
              <div class="message-time">
                <p>{{formatearHora(mensaje.fechaEnvio)}}</p>
              </div>
            </div>
          }

          <!-- validar si el mensaje es del asistente -->
          @if (mensaje.tipo === 'asistente') {
            <div class="message assistant-msg">
              <div class="message-avatar">ğŸ‘¨</div>
              <div class="message-bubble">
                <div class="message-content">
                  <p [innerHTML]="formatearMensajeAsistente(mensaje.contenido)"></p>
                </div>
                <div class="message-time">
                  {{formatearHora(mensaje.fechaEnvio)}}
                  @if (mensaje.estado === 'error') {
                    <span class="error-indicator">âš ï¸</span>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      }
      <!--si el asistente es escribiendo  -->
      @if (asistenteEscribiendo) {
        <div class="message-wrapper assistant-message">
          <div class="message assistant-msg typing">
            <div class="message-avatar">ğŸ˜‘</div>
            <div class="message-bubble">
              <div class="typing-indicator">
                <div class="typing-dots">
                  <span>ğŸ˜‘</span>
                  <span>ğŸ˜‘</span>
                  <span>ğŸ˜‘</span>
                </div>
                <p class="typing-text">El asistente estÃ¡ escribiendo...</p>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </main>
  <footer class="chat-input">
    <form class="input-form" (ngSubmit)="enviarMensaje()" #chatform="ngForm">
      <div class="input-wrapper">
        <textarea
          name="mensaje"
          #mensajeInput
          [(ngModel)]="mensajeTexto"
          class="message-input"
          placeholder="Escribe tu mensaje..."
          [disabled]="enviandoMensaje || asistenteEscribiendo"
          rows="1"
        >
        </textarea>
      </div>
      <button
        type="submit"
        class="send-btn"
        [disabled]="!mensajeTexto.trim() || enviandoMensaje || asistenteEscribiendo"
        [class.sending]="enviandoMensaje">âš ï¸
        
        @if (enviandoMensaje) {
          <span></span>
        }
        @if (!enviandoMensaje) {
          <span class="sending-spinner"></span>
        }
      </button>
    </form>
  </footer>
</div>
